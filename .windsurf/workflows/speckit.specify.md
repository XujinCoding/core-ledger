---
description: 根据自然语言功能描述创建或更新功能规范。
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，您**必须**考虑用户输入（如果非空）。

## 大纲

用户在触发消息中输入 `/speckit.specify` 后的文本**就是**功能描述。假设您在此对话中始终可以使用它，即使 `{{args}}` 在下面字面上出现。除非用户提供了空命令，否则不要要求用户重复。

根据该功能描述，请执行以下操作：

1. **创建规范相关文档**：
   
   a. 通过对话上下文中获取jira任务号`<jira-task>`，如对话上下文中未提供，则必须输出以下提示，并等待用户输入：
      ```markdown
      请输入本次任务的jira任务号`<jira-task>`
      在用户输入前不得继续执行。
      ``` 
   
   b. 创建本次规范文档目录, 运行命令：`mkdir -p "specs/<jira-task>"`
   
   c. 复制spec模板文件, 运行命令：`cp ".specify/templates/spec-template.md" "specs/<jira-task>/spec.md"`
   
2. 加载 `.specify/templates/spec-template.md` 以了解必需的部分。

3. 遵循此执行流程：

    1. 从输入中解析用户描述
       如果为空：错误 "未提供功能描述"
    2. 从描述中提取关键概念
       识别：参与者、动作、数据、约束
    3. 对于不清楚的方面：
       - 基于上下文和行业标准做出有根据的猜测
       - 仅在以下情况下标记为 [NEEDS CLARIFICATION: 具体问题]：
         - 选择显著影响功能范围或用户体验
         - 存在多个合理的解释，且具有不同的含义
         - 不存在合理的默认值
       - **限制：最多 3 个 [NEEDS CLARIFICATION] 标记**
       - 按影响优先排序：范围 > 安全性/隐私 > 用户体验 > 技术细节
    4. 填写用户场景和测试部分
       如果没有明确的用户流程：错误 "无法确定用户场景"
    5. 生成功能需求
       每个需求必须是可测试的
       为未指定的细节使用合理的默认值（在假设部分记录假设）
    6. 定义成功标准
       创建可测量的、技术无关的结果
       包括定量指标（时间、性能、数量）和定性措施（用户满意度、任务完成度）
       每个标准必须在没有实现细节的情况下可验证
    7. 识别关键实体（如果涉及数据）
    8. 返回：成功（规范准备好进行规划）

4. 使用模板结构将规范写入 `specs/<jira-task>/spec.md` ，用从功能描述（参数）派生的具体细节替换占位符，同时保留部分顺序和标题。

5. **规范质量验证**：在编写初始规范后，根据质量标准验证它：

   a. **创建规范质量检查表**：使用检查表模板结构在 `specs/<jira-task>/checklists/requirements.md` 生成检查表文件，包含以下验证项目：

      ```markdown
      # 规范质量检查表: [功能名称]
      
      **目的**: 在进行规划之前验证规范的完整性和质量
      **创建**: [日期]
      **功能**: [链接到 spec.md]
      
      ## 内容质量
      
      - [ ] 没有实现细节（语言、框架、API）
      - [ ] 专注于用户价值和业务需求
      - [ ] 为非技术利益相关者编写
      - [ ] 所有必填部分已完成
      
      ## 需求完整性
      
      - [ ] 没有 [NEEDS CLARIFICATION] 标记
      - [ ] 需求是可测试且明确的
      - [ ] 成功标准是可测量的
      - [ ] 成功标准是技术无关的（没有实现细节）
      - [ ] 所有验收场景均已定义
      - [ ] 已识别边缘情况
      - [ ] 范围明确界定
      - [ ] 已识别依赖项和假设
      
      ## 功能准备就绪
      
      - [ ] 所有功能需求都有明确的验收标准
      - [ ] 用户场景涵盖主要流程
      - [ ] 功能满足成功标准中定义的可衡量结果
      - [ ] 没有实现细节泄露到规范中
      
      ## 备注
      
      - 标记为不完整的项目在 `/speckit.clarify` 或 `/speckit.plan` 之前需要规范更新
      ```

   b. **运行验证检查**：根据每个检查表项目审查规范：
      - 对于每个项目，确定它是通过还是失败
      - 记录发现的具体问题（引用相关的规范部分）

   c. **处理验证结果**：

      - **如果所有项目都通过**：标记检查表为完成并继续执行第 6 步

      - **如果项目失败（不包括 [NEEDS CLARIFICATION]）**：
        1. 列出失败的项目和具体问题
        2. 更新规范以解决每个问题
        3. 重新运行验证，直到所有项目都通过（最多 3 次迭代）
        4. 如果在 3 次迭代后仍然失败，请在检查表备注中记录剩余问题并警告用户

      - **如果存在 [NEEDS CLARIFICATION] 标记**：
        1. 从规范中提取所有 [NEEDS CLARIFICATION: ...] 标记
        2. **限制检查**：如果存在超过 3 个标记，则仅保留 3 个最关键（按范围/安全性/用户体验影响）的标记，并对其余标记做出有根据的猜测
        3. 对于每个需要的澄清（最多 3 个），以以下格式向用户呈现选项：

           ```markdown
           ## 问题 [N]: [主题]
           
           **上下文**: [引用相关的规范部分]
           
           **我们需要知道**: [来自 NEEDS CLARIFICATION 标记的具体问题]
           
           **建议答案**:
           
           | 选项 | 答案 | 含义 |
           |------|------|------|
           | A    | [第一个建议答案] | [这对功能意味着什么] |
           | B    | [第二个建议答案] | [这对功能意味着什么] |
           | C    | [第三个建议答案] | [这对功能意味着什么] |
           | 自定义 | 提供您自己的答案 | [解释如何提供自定义输入] |
           
           **您的选择**: _[等待用户响应]_
           ```

        4. **关键 - 表格格式**：确保 markdown 表格格式正确：
           - 使用一致的间距，管道对齐
           - 每个单元格应在其内容周围有空格：`| 内容 |` 而不是 `|内容|`
           - 标题分隔符必须至少有 3 个破折号：`|------|`
           - 测试表格在 markdown 预览中是否正确渲染
        5. 问题编号按顺序（Q1、Q2、Q3 - 最多 3 个）
        6. 在等待响应之前一起呈现所有问题
        7. 等待用户响应他们对所有问题的选择（例如，"Q1: A, Q2: 自定义 - [详情], Q3: B"）
        8. 通过将每个 [NEEDS CLARIFICATION] 标记替换为用户选择或提供的答案来更新规范
        9. 在所有澄清解决后重新运行验证

   d. **更新检查表**：在每次验证迭代后，使用当前的通过/失败状态更新检查表文件

6. 报告完成情况，包括分支名称、规范文件路径、检查表结果以及下一阶段（`/speckit.clarify` 或 `/speckit.plan`）的准备情况。

## 通用指南

## 快速指南

- 专注于用户需要**什么**以及**为什么**。
- 避免如何实现（没有技术堆栈、API、代码结构）。
- 为业务利益相关者编写，而不是开发人员。
- 不要创建任何嵌入在规范中的检查表。这将是单独的命令。

### 部分要求

- **必填部分**：每个功能都必须完成
- **可选部分**：仅在与功能相关时包括
- 当某个部分不适用时，完全删除它（不要留作 "N/A"）

### 对于 AI 生成

从用户提示创建此规范时：

1. **做出有根据的猜测**：使用上下文、行业标准和常见模式来填补空白
2. **记录假设**：在假设部分记录合理的默认值
3. **限制澄清**：最多 3 个 [NEEDS CLARIFICATION] 标记 - 仅用于关键决策，这些决策：
   - 显著影响功能范围或用户体验
   - 有多个合理的解释，且具有不同的含义
   - 没有任何合理的默认值
4. **优先考虑澄清**：范围 > 安全性/隐私 > 用户体验 > 技术细节
5. **像测试人员一样思考**：每个模糊的需求都应该无法通过 "可测试且明确" 的检查表项目
6. **需要澄清的常见领域**（仅在没有合理默认值时）：
   - 功能范围和边界（包括/排除特定用例）
   - 用户类型和权限（如果存在多个冲突的解释）
   - 安全性/合规性要求（在法律/财务上重要时）

**合理默认值示例**（不要询问这些）：

- 数据保留：该领域的行业标准实践
- 性能目标：标准网页/移动应用期望，除非另有说明
- 错误处理：用户友好的消息和适当的回退
- 身份验证方法：标准基于会话或 OAuth2 用于 Web 应用
- 集成模式：RESTful API，除非另有说明

### 成功标准指南

成功标准必须是：

1. **可测量的**：包括具体指标（时间、百分比、计数、速率）
2. **技术无关的**：不提及框架、语言、数据库或工具
3. **以用户为中心的**：从用户/业务角度描述结果，而不是系统内部
4. **可验证的**：可以在不知道实现细节的情况下进行测试/验证

**好的示例**：

- "用户可以在 3 分钟内完成结账"
- "系统支持 10,000 个并发用户"
- "95% 的搜索在 1 秒内返回结果"
- "任务完成率提高 40%"

**坏的示例**（实现导向）：

- "API 响应时间低于 200ms"（太技术化，使用"用户立即看到结果"）
- "数据库可以处理 1000 TPS"（实现细节，使用面向用户的指标）
- "React 组件高效渲染"（框架特定）
- "Redis 缓存命中率高于 80%"（技术特定）